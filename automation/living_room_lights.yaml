# ##############################################################################
# ###  Detect when lights are turned on and adjust them accordingly based on time.
# ###  Based on code by @JesseWebDotCom
# ##############################################################################
#
#
# - alias: auto adjust light brightness living room
#   trigger:
#     - platform: event
#       event_type: state_changed
#   condition:
#     condition: and
#     conditions:
#       - condition: state
#         entity_id: group.family
#         state: 'home'
#       - condition: template
#         value_template: "{{ trigger.event.data is not none }}"
#       - condition: template
#         value_template: "{{ trigger.event.data.entity_id is not none }}"
#       - condition: template
#         value_template: "{{ trigger.event.data.entity_id.split('.')[0] == 'light' }}"
#       - condition: template
#         value_template: "{{ trigger.event.data.new_state.state == 'on' }}"
#       - condition: template
#         value_template: "{{ trigger.event.data.old_state.state == 'off' }}"
#       - condition: or
#         conditions:
#           - condition: template
#             value_template: "{{ trigger.event.data.entity_id.split('_')[0] == 'light.zone' }}"
#           # - condition: template
#           #   value_template: "{{ trigger.event.data.entity_id.split('_')[0] == 'light.bedroom' }}"
#           # - condition: template
#           #   value_template: "{{ trigger.event.data.entity_id.split('_')[1] == 'bedside' }}"
#           - condition: template
#             value_template: "{{ trigger.event.data.entity_id.split('_')[0] == 'light.living' }}"
# #    - condition: template
# #      value_template: "{{ trigger.event.data.entity_id.split('_')[1] != 'screensaver' }}"
#
#   action:
#     - service: light.turn_on
#       data_template:
#         entity_id: "{{ trigger.event.data.entity_id }}"
#         brightness: >
#           {% set hour=states("sensor.time").split(':')[0] | int %}
#             {%- if hour >= 5 and hour < 8  -%}
#             {{ ( 80 // (states.sensor.count_living_room_lights.state | default(1) | int) |int ) }}
#           {%- elif hour >= 8 and hour <20  -%}
#             {{ ( 255 // (states.sensor.count_living_room_lights.state | default(1) | int) |int ) }}
#           {%- elif hour >= 20 and hour <24  -%}
#             {{ ( 80 // (states.sensor.count_living_room_lights.state | default(1) | int) |int ) }}
#           {%- else -%}
#             {{ ( 15 // (states.sensor.count_living_room_lights.state | default(1) | int) |int ) }}
#           {%- endif %}
